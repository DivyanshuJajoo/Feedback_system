<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Feedback Page</title>
    <link rel="stylesheet" href="/styles_feed.css" />
    <style>
      .bullet-points {
        list-style-type: none;
        padding: 0;
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        margin-top: 6px;
      }
      .bullet-points li {
        font-weight: bold;
        cursor: pointer;
        padding: 10px;
        border-radius: 50%;
        border: 2px solid #ccc;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .bullet-points li.active {
        background-color: #007bff;
        color: #fff;
        border-color: #007bff;
      }
      .note {
        color: #555;
        font-style: italic;
        margin-bottom: 10px;
      }
      .skip-button {
        background-color: #6c757d;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 10px;
      }
      .skip-button:hover {
        background-color: #5a6268;
      }
      h5 {
        color: rgb(250, 61, 61);
      }
      h4 {
        color: #000;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 align="center">Feedback Page</h1>
      <form id="feedbackForm" action="/submit-feedback" method="post">
        <h5>Note: <i>10</i> will be considered as <b><i>best</i></b> and <i>1</i> will be considered as <b><i>worst</i></b>.</h5>

        <input type="hidden" name="uniqueId" id="uniqueId" value="<%= uniqueId %>">
        <input type="hidden" name="faculties" id="faculties" value='<%= JSON.stringify(faculties) %>'>

        <% faculties.forEach((faculty, index) => { %>
        <div class="faculty-feedback" id="faculty<%= index %>" style="<%= index === 0 ? '' : 'display: none;' %>">
          <% const { subject, Assigned_faculty } = faculty; %>
          <label>Subject: <%= subject %></label><br />
          <label>Faculty: <%= Assigned_faculty.faculty_name %></label><br />

          <% for (let i = 1; i <= 10; i++) { %>
          <h4><%= questionsArray[i-1] %></h4>
          <div style="display: flex; justify-content: space-between; font-style: italic; font-weight: bold;">
            <span>Worst</span> <span>Best</span>
          </div>
          <ul class="bullet-points">
            <% for (let j = 1; j <= 10; j++) { %>
            <li onclick="selectPoint(<%= j %>, <%= i %> ,<%= index %>)" id="point<%= index %>-<%= i %>-<%= j %>">
              <%= j %>
            </li>
            <% } %>
          </ul>
          <input type="hidden" name="selectedPoint<%= index %>-<%= i %>" id="selectedPoint<%= index %>-<%= i %>" value="0" />
          <% } %>

          <label for="remark<%= index %>">Remark:</label><br />
          <textarea id="remark<%= index %>" name="remark<%= index %>" rows="4" cols="50"></textarea><br /><br />

          <% if (index > 0) { %>
            <button type="button" onclick="showPreviousFaculty(<%= index %>)" id="prevButton<%= index %>">
              Previous
            </button>
          <% } %>
          <% if (index === faculties.length - 1) { %>
            <button type="submit" id="submitButton" style="display: none">
              Submit
            </button>
          <% } else { %>
          <button type="button" onclick="showNextFaculty(<%= index %>)">
            Next
          </button>
          <% } %>
        </div>
        <% }); %>
      </form>
    </div>

    <script>
      var currentIndex = 0;
      var facultiesCount = <%= faculties.length %>;

      window.onload = function() {
          if (document.getElementById("prevButton0")) {
              document.getElementById("prevButton0").disabled = true;
          }
      };

      function showNextFaculty(index) {
          document.getElementById('faculty' + index).style.display = 'none';
          currentIndex = index + 1;
          if (currentIndex < facultiesCount) {
              document.getElementById('faculty' + currentIndex).style.display = 'block';
          }
          if (currentIndex === facultiesCount - 1) {
              document.getElementById('submitButton').style.display = 'inline';
          }
      }

      function showPreviousFaculty(index) {
          document.getElementById('faculty' + index).style.display = 'none';
          currentIndex = index - 1;
          document.getElementById('faculty' + currentIndex).style.display = 'block';
      }

      function selectPoint(point, question, index) {
          for(let i = 1; i <= 10; i++) {
              var pnt = document.getElementById('point' + index + '-' + question + '-' + i);
              pnt.classList.remove('active');
          }
          document.getElementById('point' + index + '-' + question + '-' + point).classList.add('active');
          document.getElementById('selectedPoint' + index + '-' + question).value = point;
      }

      // Confirmation before submission
      document.getElementById("feedbackForm").addEventListener("submit", function (event) {
          var confirmation = confirm("Are you sure you want to submit your feedback? Once submitted, it cannot be changed.");
          if (!confirmation) {
              event.preventDefault(); // Prevent form submission if user cancels
          }
      });

    </script>
  </body>
</html>
